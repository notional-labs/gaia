(window.webpackJsonp=window.webpackJsonp||[]).push([[149],{531:function(e,a,s){"use strict";s.r(a);var t=s(1),o=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"gaia-fee-ante-handler"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gaia-fee-ante-handler"}},[e._v("#")]),e._v(" Gaia Fee Ante-handler")]),e._v(" "),s("h2",{attrs:{id:"gaia-fees"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gaia-fees"}},[e._v("#")]),e._v(" Gaia Fees")]),e._v(" "),s("p",[e._v("The CosmosHub has two types of fees, both of which, are the "),s("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/a1143138716b64bc4fa0aa53c0f0fa59eb675bb7/types/dec_coin.go#L158",target:"_blank",rel:"noopener noreferrer"}},[e._v("sdk.DecCoins"),s("OutboundLink")],1),e._v(" type:")]),e._v(" "),s("ul",[s("li",[e._v("global fees (are defined at the network level, via "),s("a",{attrs:{href:"https://hub.cosmos.network/main/governance/proposals/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Gov Proposals"),s("OutboundLink")],1),e._v(")")]),e._v(" "),s("li",[e._v("min_gas_prices (are specified validator node, in the "),s("code",[e._v("config/app.toml")]),e._v(" configuration file)")])]),e._v(" "),s("h3",{attrs:{id:"global-fees"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#global-fees"}},[e._v("#")]),e._v(" Global Fees")]),e._v(" "),s("h4",{attrs:{id:"global-fees-concept"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#global-fees-concept"}},[e._v("#")]),e._v(" Global Fees Concept")]),e._v(" "),s("p",[e._v("Global fees are the fees that each transaction incursâ€”except [bypass fee message types](###Bypass Fees Message Types). Global fees are set up through a governance proposal which must be voted on by validators.")]),e._v(" "),s("p",[e._v("For  "),s("a",{attrs:{href:"https://github.com/cosmos/gaia/blob/82c4353ab1b04cf656a8c95d226c30c7845f157b/x/globalfee/types/params.go#L54-L99",target:"_blank",rel:"noopener noreferrer"}},[e._v("global fees"),s("OutboundLink")],1),e._v(" to be valid:")]),e._v(" "),s("ul",[s("li",[e._v("fees have to be alphabetically sorted by denomination (denom)")]),e._v(" "),s("li",[e._v("fees must to have non-negative amount, with a valid and unique denom (i.e no duplicate denoms are allowed).")])]),e._v(" "),s("p",[e._v("Global fees allow denoms with zero coins or value.")]),e._v(" "),s("p",[e._v("Zero value coins are used to define fee denoms, when the chain does not charge fees. Each transaction (except bypass transactions) have to meet the following global fee requirements:")]),e._v(" "),s("ul",[s("li",[e._v("All denoms of the paid fees (except zero coins) have to be a subset of the global fee's denom set.")]),e._v(" "),s("li",[e._v("All paidfees' contain at least one denom that is present and greater than/or equal to the amount of the same denom in globalfee.")])]),e._v(" "),s("h4",{attrs:{id:"query-global-fees"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#query-global-fees"}},[e._v("#")]),e._v(" Query Global Fees")]),e._v(" "),s("p",[e._v("CLI queries to retrieve the global fee value:")]),e._v(" "),s("tm-code-block",{staticClass:"codeblock",attrs:{language:"shell",base64:"Z2FpYWQgcSBnbG9iYWxmZWUgbWluaW11bS1nYXMtcHJpY2VzCiMgb3IKZ2FpYWQgcSBwYXJhbXMgc3Vic3BhY2UgZ2xvYmFsZmVlIE1pbmltdW1HYXNQcmljZXNQYXJhbQo="}}),e._v(" "),s("h4",{attrs:{id:"empty-global-fees-and-default-global-fees"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#empty-global-fees-and-default-global-fees"}},[e._v("#")]),e._v(" Empty Global Fees and Default Global Fees")]),e._v(" "),s("p",[e._v("When the global fee is not setup, the query will return an empty globalfee list: "),s("code",[e._v("minimum_gas_prices: []")]),e._v(". Gaiad will use "),s("code",[e._v("0uatom")]),e._v(" as global fee in this case. This is due to the CosmosHub accepting uatom as fee denom by default.")]),e._v(" "),s("h4",{attrs:{id:"setting-up-global-fees-via-gov-proposals"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-global-fees-via-gov-proposals"}},[e._v("#")]),e._v(" Setting Up Global Fees via Gov Proposals")]),e._v(" "),s("p",[e._v("An example of setting up a global fee by a gov proposals is shown below.")]),e._v(" "),s("tm-code-block",{staticClass:"codeblock",attrs:{language:"shell",base64:"Z292IHN1Ym1pdC1sZWdhY3ktcHJvcG9zYWwgcGFyYW0tY2hhbmdlIHByb3Bvc2FsLmpzb24K"}}),e._v(" "),s("p",[e._v("A "),s("code",[e._v("proposal.json")]),e._v(" example:")]),e._v(" "),s("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"ewogICZxdW90O3RpdGxlJnF1b3Q7OiAmcXVvdDtHbG9iYWwgZmVlcyBQYXJhbSBDaGFuZ2UmcXVvdDssCiAgJnF1b3Q7ZGVzY3JpcHRpb24mcXVvdDs6ICZxdW90O1VwZGF0ZSBnbG9iYWwgZmVlcyZxdW90OywKICAmcXVvdDtjaGFuZ2VzJnF1b3Q7OiBbCiAgICB7CiAgICAgICZxdW90O3N1YnNwYWNlJnF1b3Q7OiAmcXVvdDtnbG9iYWxmZWUmcXVvdDssCiAgICAgICZxdW90O2tleSZxdW90OzogJnF1b3Q7TWluaW11bUdhc1ByaWNlc1BhcmFtJnF1b3Q7LAogICAgICAmcXVvdDt2YWx1ZSZxdW90OzogW3smcXVvdDtkZW5vbSZxdW90OzomcXVvdDtzdGFrZSZxdW90OywgJnF1b3Q7YW1vdW50JnF1b3Q7OiZxdW90OzAuMDAyJnF1b3Q7fSwgeyZxdW90O2Rlbm9tJnF1b3Q7OiZxdW90O3VhdG9tJnF1b3Q7LCAmcXVvdDthbW91bnQmcXVvdDs6ICZxdW90OzAuMDAxJnF1b3Q7fV0KICAgIH0KICBdLAogICZxdW90O2RlcG9zaXQmcXVvdDs6ICZxdW90OzEwMDBzdGFrZSZxdW90Owp9Cg=="}}),e._v(" "),s("p",[e._v('Please note: in the above "value" field, coins must sorted alphabetically by denom.')]),e._v(" "),s("h3",{attrs:{id:"min-gas-prices"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#min-gas-prices"}},[e._v("#")]),e._v(" Min_gas_prices")]),e._v(" "),s("p",[e._v("min_gas_prices are a node's further requirement of fees. Zero coins are removed from min_gas_prices when "),s("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/3a097012b59413641ac92f18f226c5d6b674ae42/baseapp/options.go#L27",target:"_blank",rel:"noopener noreferrer"}},[e._v("parsing min_gas_prices"),s("OutboundLink")],1),e._v(", this is different from global fees.")]),e._v(" "),s("ul",[s("li",[e._v("If the min_gas_prices set a denom that is not global fees's denom set. This min_gas_prices denom will not be considered when paying fees.")]),e._v(" "),s("li",[e._v("If the min_gas_prices have a denom in global fees's denom set, and the  min_gas_prices are lower than global fees, the fee still need to meet the global fees.")]),e._v(" "),s("li",[e._v("If the min_gas_prices have a denom in global fees's denom set, and the  min_gas_prices are higher than global fees, the fee need to meet the min_gas_prices.")])]),e._v(" "),s("h2",{attrs:{id:"fee-checks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fee-checks"}},[e._v("#")]),e._v(" Fee Checks")]),e._v(" "),s("p",[e._v("Global fees, min_gas_prices and the paid fees all allow zero coins setup. After parsing the fee coins, zero coins and paid fees will be removed from the min_gas_prices and paid fees.")]),e._v(" "),s("p",[e._v("Only global fees might contain zero coins, which is used to define the allowed denoms of paid fees.")]),e._v(" "),s("p",[e._v("The "),s("a",{attrs:{href:"../../../x/globalfee/ante/fee.go"}},[e._v("Fee AnteHandle")]),e._v(" will take global fees and min_gas_prices and merge them into one "),s("a",{attrs:{href:"https://github.com/cosmos/gaia/blob/f2be720353a969b6362feff369218eb9056a60b9/ante/fee.go#L79",target:"_blank",rel:"noopener noreferrer"}},[e._v("combined "),s("code",[e._v("sdk.Deccoins")]),s("OutboundLink")],1),e._v(" according to the denoms and amounts of global fees and min_gas_prices.")]),e._v(" "),s("p",[e._v("If the paid fee is a subset of the combined fees set and the paid fee amount is greater than or equal to the required fees amount, the transaction can pass the fee check, otherwise an error will occur.")]),e._v(" "),s("h3",{attrs:{id:"bypass-fees-message-types"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bypass-fees-message-types"}},[e._v("#")]),e._v(" Bypass Fees Message Types")]),e._v(" "),s("p",[e._v("The above global fee and min_as_prices fee checks do not apply to bypass message types. Transactions of  bypass message types are free of fee charge. However, if the bypass type transactions still carry nonzero fees, the denom has to be a subset of denoms that global fees defined.")]),e._v(" "),s("p",[e._v("A node can set up its own bypass message types by modify the configuration parameter "),s("code",[e._v("bypass-min-fee-msg-types")]),e._v(" in "),s("code",[e._v("config/app.toml")]),e._v(" file. Nodes using "),s("code",[e._v("app.toml")]),e._v(" files initialized by gaiad version of v7.0.1 or earlier might not have "),s("code",[e._v("bypass-min-fee-msg-types")]),e._v(", users can insert it before the field "),s("code",[e._v("[telemetry]")]),e._v(" in "),s("code",[e._v("app.toml")]),e._v(".")]),e._v(" "),s("p",[e._v("An example:")]),e._v(" "),s("tm-code-block",{staticClass:"codeblock",attrs:{language:"shell",base64:"CiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tIEdhaWEgQ29uZmlndXJhdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgYnlwYXNzLW1pbi1mZWUtbXNnLXR5cGVzIGRlZmluZXMgY3VzdG9tIG1lc3NhZ2UgdHlwZXMgdGhlIG9wZXJhdG9yIG1heSBzZXQgdGhhdAojIHdpbGwgYnlwYXNzIG1pbmltdW0gZmVlIGNoZWNrcyBkdXJpbmcgQ2hlY2tUeC4KIwojIEV4YW1wbGU6CiMgWyZxdW90Oy9pYmMuY29yZS5jaGFubmVsLnYxLk1zZ1JlY3ZQYWNrZXQmcXVvdDssICZxdW90Oy9pYmMuY29yZS5jaGFubmVsLnYxLk1zZ0Fja25vd2xlZGdlbWVudCZxdW90OywgLi4uXQpieXBhc3MtbWluLWZlZS1tc2ctdHlwZXMgPSBbJnF1b3Q7L2liYy5jb3JlLmNoYW5uZWwudjEuTXNnUmVjdlBhY2tldCZxdW90OywgJnF1b3Q7L2liYy5jb3JlLmNoYW5uZWwudjEuTXNnQWNrbm93bGVkZ2VtZW50JnF1b3Q7LCZxdW90Oy9pYmMuYXBwbGljYXRpb25zLnRyYW5zZmVyLnYxLk1zZ1RyYW5zZmVyJnF1b3Q7XQo="}}),e._v(" "),s("p",[e._v("Even though each node can set its own "),s("code",[e._v("min_gas_prices")]),e._v(" and "),s("code",[e._v("bypass-min-fee-msg-types")]),e._v(", when the transactions enters a validator's mempool, the transactions carried fees have to satisfy the validator's "),s("code",[e._v("min_gas_prices")]),e._v(" and "),s("code",[e._v("bypass-min-fee-msg-types")]),e._v("'s requirement in order for the validators to process the transactions.")]),e._v(" "),s("h2",{attrs:{id:"examples"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#examples"}},[e._v("#")]),e._v(" Examples")]),e._v(" "),s("p",[e._v("Here are a few examples to clarify the relationship between global fees, min_gas_prices and paid fees.")]),e._v(" "),s("ul",[s("li",[s("p",[s("strong",[e._v("Case 1")]),e._v(": globalfee=[], min_gas_prices=0.0001uatom, gas=2000000")]),e._v(" "),s("p",[e._v("This is the same case as globalfee=0uatom, min_gas_prices=0.0001uatom, gas=2000000.")]),e._v(" "),s("ul",[s("li",[e._v('paidfee = "2000000 * 0.0001uatom", pass')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0001uatom, 0stake", pass')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0001uatom, 1stake", fail')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0001/2uatom", fail')]),e._v(" "),s("li",[e._v('paidfee = "", pass')])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("Case 2")]),e._v(': globalfee=[], min_gas_prices="", gas=2000000')]),e._v(" "),s("ul",[s("li",[e._v('paidfee = "", pass')]),e._v(" "),s("li",[e._v('paidfee = "0uatom", pass')]),e._v(" "),s("li",[e._v('paidfee = "1uatom", pass')]),e._v(" "),s("li",[e._v('paidfee = "0uatom, 0stake", pass')]),e._v(" "),s("li",[e._v('paidfee = "0uatom, 1stake", fail')])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("Case 3")]),e._v(": globalfee=0.0002uatom, min_gas_prices=0.0001uatom, gas=2000000 (global fee is lower than min_as_price)")]),e._v(" "),s("ul",[s("li",[e._v('paidfee = "2000000 * 0.0002uatom", pass')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0001uatom", fail')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0002uatom, 1stake", fail')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0002uatom, 0stake", pass')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0002stake", fail')]),e._v(" "),s("li",[e._v('paidfee = "", fail')]),e._v(" "),s("li",[e._v("paidfee = 0uatom, fail")])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("Case 4")]),e._v(":  globalfee=0.0001uatom, min_gas_prices=0.0002uatom, gas=2000000 (global fee is higher than min_as_price)")]),e._v(" "),s("ul",[s("li",[e._v('paidfee = "2000000 * 0.0002uatom", pass')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0001uatom", fail')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0002uatom, 1stake", fail')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0002uatom, 0stake", pass')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0002stake", fail')]),e._v(" "),s("li",[e._v('paidfee = "", fail')]),e._v(" "),s("li",[e._v("paidfee = 0uatom, fail")])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("Case 5")]),e._v(': globalfee=[0uatom, 1stake], min_gas_prices="", gas=200000.')])]),e._v(" "),s("li",[s("p",[e._v('fees="2000000 * 0uatom, 2000000 * 0.5stake", fail, (this is due to '),s("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/e716e4103e934344aa7be6dc9b5c453bdec5f225/client/tx/factory.go#L144",target:"_blank",rel:"noopener noreferrer"}},[e._v("fee parsing, zero coins are removed"),s("OutboundLink")],1),e._v(", it equals to paidfees = 0.5stake in this case)")])]),e._v(" "),s("li",[s("p",[e._v('paidfees="", pass')])]),e._v(" "),s("li",[s("p",[e._v('paidfees="2000000 * 1uatom, 0.5stake", pass')])]),e._v(" "),s("li",[s("p",[e._v('paidfees="0uatom, 0stake" pass, (due to the parsing of paidfees, it makes paidfees="")')])]),e._v(" "),s("li",[s("p",[e._v('paidfees="2000000 * 1stake", pass')])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("Case 6")]),e._v(": globalfee=[0.001uatom, 1stake], min_gas_prices=0.002uatom, gas=200000.")]),e._v(" "),s("ul",[s("li",[e._v('paidfee = "2000000 * 0.0002uatom", pass')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0001uatom", fail')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 1stake", pass')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 1/2stake", fail')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0001uatom, 2000000*1stake", pass')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0002atom, 2000000*1/2stake", pass')]),e._v(" "),s("li",[e._v('paidfee = "2000000 * 0.0001uatom, 2000000*1/2stake", fail')])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("Case 7")]),e._v(":globalfee=[0.0001uatom], min_gas_prices=0.0002uatom,1stake, gas=200000.")]),e._v(" "),s("p",[s("code",[e._v('bypass-min-fee-msg-types = ["/cosmos.distribution.v1beta1.MsgWithdrawDelegatorReward"]')])]),e._v(" "),s("ul",[s("li",[e._v("msg withdraw-all-rewards with paidfee=0uatom, pass")]),e._v(" "),s("li",[e._v("msg withdraw-all-rewards with paidfee=200000 * 0.0001/2uatom, pass")]),e._v(" "),s("li",[e._v("msg withdraw-all-rewards with paidfee=0stake,0photon, pass")]),e._v(" "),s("li",[e._v("msg withdraw-all-rewards with paidfee=200000 * 1stake, 0photon, fail")])])])]),e._v(" "),s("h2",{attrs:{id:"reference"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[e._v("#")]),e._v(" Reference")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.cosmos.network/main/basics/gas-fees.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Fee caculations: fee and gas"),s("OutboundLink")],1)])])],1)}),[],!1,null,null,null);a.default=o.exports}}]);